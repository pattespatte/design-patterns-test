<button type="button" class="btn js-toggle-dark-mode" aria-label="Växla mellan ljust och mörkt tema">
	<!-- Sun icon for light mode (shown when dark mode is active) -->
	<svg class="theme-icon sun-icon" style="display: none;" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
		<circle cx="12" cy="12" r="5"></circle>
		<line x1="12" y1="1" x2="12" y2="3"></line>
		<line x1="12" y1="21" x2="12" y2="23"></line>
		<line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
		<line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
		<line x1="1" y1="12" x2="3" y2="12"></line>
		<line x1="21" y1="12" x2="23" y2="12"></line>
		<line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
		<line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
	</svg>

	<!-- Moon icon for dark mode (shown when light mode is active) -->
	<svg class="theme-icon moon-icon" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
		<path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
	</svg>
</button>

<script>
	// Wait for DOM to be ready
	jtd.onReady(function () {
		// Check if jtd is available
		if (typeof jtd === 'undefined') {
			return;
		}

		// Get toggle button
		const toggleDarkMode = document.querySelector('.js-toggle-dark-mode');
		const sunIcon = document.querySelector('.sun-icon');
		const moonIcon = document.querySelector('.moon-icon');

		if (!toggleDarkMode || !sunIcon || !moonIcon) {
			return;
		}

		// Check for saved theme preference or default to 'light'
		const currentTheme = localStorage.getItem('theme') || 'light';

		// Function to update icon visibility
		function updateIcons(theme) {
			if (theme === 'dark') {
				sunIcon.style.display = 'block';
				moonIcon.style.display = 'none';
				// Add dark mode class to button
				toggleDarkMode.classList.add('dark-mode');
				toggleDarkMode.classList.remove('light-mode');
			} else {
				sunIcon.style.display = 'none';
				moonIcon.style.display = 'block';
				// Add light mode class to button
				toggleDarkMode.classList.add('light-mode');
				toggleDarkMode.classList.remove('dark-mode');
			}
		}

		// Apply the saved theme on page load
		if (currentTheme === 'dark') {
			jtd.setTheme('dark');
			updateIcons('dark');
			// Add dark class to HTML element for our CSS to work
			document.documentElement.classList.add('dark');
		} else {
			updateIcons('light');
		}

		// Add click event listener
		jtd.addEvent(toggleDarkMode, 'click', function () {
			const currentTheme = jtd.getTheme();

			if (currentTheme === 'dark') {
				jtd.setTheme('light');
				updateIcons('light');
				localStorage.setItem('theme', 'light');
				// Remove dark class from HTML element
				document.documentElement.classList.remove('dark');
			} else {
				jtd.setTheme('dark');
				updateIcons('dark');
				localStorage.setItem('theme', 'dark');
				// Add dark class to HTML element for our CSS to work
				document.documentElement.classList.add('dark');
			}
		});

		// Check mobile viewport
		function checkMobileViewport() {
			const isMobile = window.innerWidth <= 768;
		}

		// Check viewport on load and resize
		checkMobileViewport();
		window.addEventListener('resize', checkMobileViewport);
	});
</script>

<style>
	.js-toggle-dark-mode {
		display: flex !important;
		align-items: center !important;
		justify-content: center !important;
		min-width: 44px !important;
		min-height: 44px !important;
		padding: 8px !important;
		margin-left: 1rem;
		background: transparent;
		border: 1px solid var(--color-border);
		box-shadow: none;
		cursor: pointer;
		border-radius: 4px;
		transition: all 0.2s ease;
		position: relative;
		z-index: 10;
	}

	.js-toggle-dark-mode:hover {
		background: var(--color-grey-lt-000);
	}

	.js-toggle-dark-mode:focus {
		outline: 2px solid #1d70b8;
		outline-offset: 2px;
	}

	.theme-icon {
		width: 20px;
		height: 20px;
		transition: opacity 0.2s ease;
		stroke: #27262b;
	}

	/* Light mode styles */
	.js-toggle-dark-mode.light-mode .theme-icon {
		stroke: #27262b !important;
	}

	/* Dark mode styles */
	.js-toggle-dark-mode.dark-mode {
		border-color: var(--color-grey-dk-100) !important;
	}

	.js-toggle-dark-mode.dark-mode:hover {
		background: var(--color-grey-dk-100) !important;
	}

	.js-toggle-dark-mode.dark-mode .theme-icon {
		stroke: #fafafa !important;
	}

	/* Ensure visibility on mobile */
	@media (max-width: 768px) {
		.js-toggle-dark-mode {
			min-width: 44px !important;
			min-height: 44px !important;
			padding: 8px !important;
			position: fixed !important;
			top: 10px !important;
			right: 60px !important;
			z-index: 100 !important;
			background: transparent !important;
			border: 1px solid var(--color-border) !important;
		}

		.js-toggle-dark-mode.dark-mode {
			background: transparent !important;
		}

		.theme-icon {
			width: 20px;
			height: 20px;
		}
}
</style>

<script>
	// Add aria-current="page" to active navigation link
	document.addEventListener('DOMContentLoaded', function() {
		const currentPath = window.location.pathname;
		const navLinks = document.querySelectorAll('.nav-list-link');

		navLinks.forEach(link => {
			if (link.getAttribute('href') === currentPath) {
				link.setAttribute('aria-current', 'page');
			}
		});
	});
</script>